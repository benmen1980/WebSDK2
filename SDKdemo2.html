<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Customer Entry</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <style>
        .wrapper {
            position: relative;
            width: 400px;
            height: 200px;
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        .canimg {
            position: absolute;
            left: 0;
            top: 0;
        }

        .signature-pad {
            position: absolute;
            left: 0;
            top: 0;
            width:400px;
            height:200px;
        }
    </style>
</head>
<body>

<!-- header and navigation -->
<div>
<img src="media\logo2.png" class="img-fluid rounded float-left" alt="Responsive image">
</div>


<!-- main form section -->
<form>
<div id="container" class="p-3" onchange="fieldChangeHandler(event)" tabindex="1" onblur="saveHandler()" >
    <div class="form-group">
        <label class="labelStyle">Customer Number</label>
        <input class="form-control" id="CUSTNAME" readonly>

        <label class="labelStyle">Customer Name</label>
        <input class="form-control" id="CUSTDES">

        <label class="labelStyle">Status</label>
        <select id="STATDES" class="custom-select">
            <option label="Choose a status" disabled></option>
        </select>
        <!--button type="submit" onClick="chooseHandler('STATDES')" class="btn btn-primary">Get values</button-->

        <label class="labelStyle">Assigned to</label>
        <select id="OWNERLOGIN" class="custom-select">
            <option label="Choose a username" disabled></option>
        </select>
        <!--button class="btn btn-primary" onClick="chooseHandler('OWNERLOGIN')">Get values</button-->

        <label class="labelStyle">Date Opened</label>
        <input class="form-control" id="CREATEDDATE" readonly>
    </div>


</div>
</form>
<!-- end of main form section -->

<!-- sub tabs section -->
  <ul class="nav nav-tabs" id="myTab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Signature Pad</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false" onclick="mystartsubform()">Upload files here</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact" aria-selected="false">Help</a>
  </li>
</ul>

    <!-- tab content -->
<div class="tab-content" id="myTabContent">

    <!-- signature pad -->
  <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">

      <h6>
          Sign here...
      </h6>
      <div class="wrapper">
          <img class="canimg" src="http://www.licensing.biz/cimages/c0f1a3a97bc0de97271f9813f7715bb3.png" width=400 height=200 />
          <canvas id="signature-pad" class="signature-pad" width=400 height=200></canvas>
      </div>
      <div>
          <button id="save">Save</button>
          <button id="clear">Clear</button>
      </div>

      <!-- file upload -->

      <div class="container">
          <div class="ProgressBar" >
              <h2>File is uploading...</h2>
              <div class="progress">
                  <div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width:10%">
                      <span class="sr-only">10% Complete</span>
                  </div>
              </div>
          </div>
      </div>





  </div>
    <!-- file upload -->
  <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">	
	<div class="input-group mb-3">
		<div class="input-group-prepend">
		<span class="input-group-text" onclick="loadfiletopriority()"><a onclick="loadfiletopriority()">Upload</a></span>
		</div>

		<div class="custom-file">
		<input type="file" class="custom-file-input" id="uploadfile">
		<label  id="lblfilepath" class="custom-file-label" for="uploadfile">Choose file</label>
		
		<input type="hidden"  id="EXTFILENAME" onchange="SubfieldChangeHandler(event)" >
		<input type="hidden"  id="EXTFILEDES" onchange="SubfieldChangeHandler(event)"> 
		</div>
		<div class="container">
  <div class="ProgressBar" >
  <h2>File is uploading...</h2>
  <div class="progress">
    <div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width:10%">
      <span class="sr-only">10% Complete</span>
    </div>
  </div>
  </div>
</div>
    </div>
	</div>
	<!-- help or about  -->
    <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
	<a href="http.simplyct.co.il" target="_blank">Created By SimplyCT Creative Technology Version </a><a href="https://prioritysoftware.github.io/" target="_blank">Priority SDK</a>
  </div>
  
</div>


<div class="form-group">
	</br></br></br></br>
  <button class="btn btn-outline-secondary" onclick="saveHandler()">Save Form</button>
  <button class="btn btn-outline-secondary" onclick="SaveSubForm()">Save Sub Form</button>

  </div>

	
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
<script src="https://cdn.priority-software.com/upgrades/var/api/v1.5/priorityapp.nocache.js"></script>
<script>
 
	
			
			
	
function chooseHandler(targetField, someObj) {
		var targetValue = document.getElementById(targetField).value;
		myform.choose(targetField, targetValue).then(function(result) {
			console.log(result);
			// Get dropdown element from DOM
			var dropdown = document.getElementById(targetField);
			if(result.ChooseLine){
			myArray = result.ChooseLine;
			}else{
			myArray = result.SearchLine;
			}
			// Loop through the array
			for (var i = 0; i < myArray.length; ++i) {
				// Append the element to the end of Array list
				var value ;
				var name;
				if(result.ChooseLine){
					name = myArray[i].string1;
					value = myArray[i].string1;
				}else{
					value = myArray[i].string2;
					name = myArray[i].string1;
				}
				dropdown[dropdown.length] = new Option(name,value);
				}});
		}


    function updateFields(result) {
        if (result["CUSTOMERS"]) {
            var fields = result["CUSTOMERS"][1];
            for (var fieldName in fields) {
                var el = document.getElementById(fieldName);
                if(el) el.value = fields[fieldName];
				// nned to add assignment for select fields
            }
        }
    }
	
	 function updateSubFields(result) {
        if (result["CUSTEXTFILE"]) {
            var fields = result["CUSTEXTFILE"][1];
            for (var fieldName in fields) {
                var el = document.getElementById(fieldName);
                if(el) el.value = fields[fieldName];
				// nned to add assignment for select fields
            }
        }
    }

    function showMessage(message) {
        if (message.type != "warning") {
            alert(message.message);
        } else {
            if (confirm(message.message)) {
                message.form.warningConfirm(1);
            } else {
                message.form.warningConfirm(0);
            }
        }
    }

    function fieldChangeHandler(event) {
        myform.fieldUpdate(event.srcElement.id, event.target.value);
    }
	
	
	function SubfieldChangeHandler(event){
		mysubform.fieldUpdate(event.srcElement.id, event.target.value);
		}

    function priorityReady() {
        login({
            username: 'demo', password: '123456',
            url: '', tabulaini:  'tabula.ini',
            language: 2, company: 'demo2', appname: 'Customers'})
    .then(function(result) {
            console.log('Connected to Priority! ');
			return formStart('CUSTOMERS', showMessage, updateFields);
        }).then(function(form) {
            myform = form;
			chooseHandler('STATDES',null);
			chooseHandler('OWNERLOGIN',null);
        });
    }
	function saveHandler() {
  myform.saveRow(0);
  }
  
  
  
  var mysubform;
  
  function SaveSubForm(){
	mysubform.saveRow(0);
	}
  
  function mystartsubform(){
  if(!mysubform) {
      myform.startSubForm('CUSTEXTFILE', showMessage, updateSubFields, function (result) {
          console.log('start sub form ' + result.name);
          mysubform = result;
          }, function () {
      });
    }
  }
  
  function loadfiletopriority(event){
  
 var x = document.getElementById('uploadfile').files[0];
  mysubform.uploadFile(document.getElementById('uploadfile').files[0],function(result){
	 $('.progress-bar').css('width', result.progress +'%').attr('aria-valuenow', result.progress);
	if(result.file){
		document.getElementById('lblfilepath').innerHTML = 'File update successfuly to Priority server';
		document.getElementById('EXTFILEDES').value = document.getElementById('uploadfile').files[0];
		mysubform.fieldUpdate('EXTFILEDES', 'File uploaded');
		document.getElementById('EXTFILENAME').value = result.file;
		mysubform.fieldUpdate('EXTFILENAME',result.file);
		mysubform.saveRow(0,function(){console.log('sub form saved successfuly!')},function(result){console.log(result.message)});
		console.log('file ' + result.file +' upload completed!');
		//mysubform.fieldUpdate('EXTFILENAME',result.file);
		}
	})
  }


</script>
<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<script>
    var signaturePad = new SignaturePad(document.getElementById('signature-pad'), {
        backgroundColor: 'rgba(255, 255, 255, 0)',
        penColor: 'rgb(0, 0, 0)'
    });
    var saveButton = document.getElementById('save');
    var cancelButton = document.getElementById('clear');

    saveButton.addEventListener('click', function (event) {
        var data = signaturePad.toDataURL('image/png');

// Send data to server instead...

    mysubform.uploadDataUrl(data,'.png',
        //progress
        function(result) {
            $('.progress-bar').css('width', result.progress + '%').attr('aria-valuenow', result.progress);
        },
        // onSuccess
        function(result){
        document.getElementById('lblfilepath').innerHTML = 'File update successfuly to Priority server';
        document.getElementById('EXTFILEDES').value = document.getElementById('uploadfile').files[0];
        mysubform.fieldUpdate('EXTFILEDES', 'File uploaded');
        document.getElementById('EXTFILENAME').value = result.file;
        mysubform.fieldUpdate('EXTFILENAME',result.file);
        mysubform.saveRow(0,function(){console.log('sub form saved successfuly!')},function(result){console.log(result.message)});
        console.log('file ' + result.file +' upload completed!');
        },
        //on error
        function(serverResponse){
            console.log('Error from server: ' + serverResponse.message);
        });
       // window.open(data);
    });

    //cancelButton.addEventListener('click', function (event) {
       // signaturePad.clear();
   // });
</script>
</body>
</html>